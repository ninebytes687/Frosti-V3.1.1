---
title: "Linux SSH安全配置"
description: "使用Debian12进行操作"
pubDate: "Mar 17 2025"
image: "https://s21.ax1x.com/2025/03/17/pEdN1DP.png"
categories:
  - tech
tags:
  - Linux
  - Rocky Linux
---

import Collapse from "../../components/mdx/Collapse.astro"
import Diff from "../../components/mdx/Diff.astro"
import Error from "../../components/mdx/Error.astro";
import Info from "../../components/mdx/Info.astro";
import Kbd from "../../components/mdx/Kbd.astro"
import Success from "../../components/mdx/Success.astro";
import Warning from "../../components/mdx/Warning.astro";
import TimeLine from "../../components/mdx/TimeLine.astro";
import LinkCard from "../../components/mdx/LinkCard.astro";

# 修改SSH端口号
在Linux中，默认的SSH端口号为22，由于这是人尽皆知的，容易被入侵者扫描。  
通过修改SSH的配置文件实现修改端口号：`sudo vim /etc/ssh/sshd_config`  
端口号定义范围最大不能超过65535；也不要占用常用的端口；例如20、21等。可以自己自定义一个高位端口号。  
![1](https://s1.imagehub.cc/images/2025/04/28/62835fbd3100bbaa063f6b8424fced10.png)
使用`sudo systemctl restart sshd && systemctl status sshd`命令重启ssh服务并查看状态。  
![2](https://s1.imagehub.cc/images/2025/04/28/018da7dd6fe13e4707b75e98e693dc4e.png)
或者使用：`lsof -i:62771`查看62771端口占用情况。  
![9](https://s1.imagehub.cc/images/2025/04/28/d9e0ec49e6f068dbe50385b3fa172f94.png)

# 禁止Root用户SSH登录
禁止Root用户SSH登录可以直接防御暴力破解。Root用户是Linux系统的默认超级用户，攻击者会优先尝试此账户。  
通过修改SSH的配置文件实现禁止Root用户登录：`sudo vim /etc/ssh/sshd_config`。  
将`PermitRootLogin yes`修改为`PermitRootLogin no`。  
![3](https://s1.imagehub.cc/images/2025/04/28/5971000533b6d68d41629d86d047c77f.png)
最后重启ssh服务`sudo systemctl restart sshd`即可。  

# 创建普通用户并赋予sudo权限
创建一个用户`testuser`并赋予sudo权限：`sudo adduser testuser`。  
![4](https://s1.imagehub.cc/images/2025/04/28/845c59cdaf382cb3047649fb8d9d9500.png)
**将testuser用户加入sudo用户组：**  
使用命令`sudo usermod -aG sudo testuser`。  
![5](https://s1.imagehub.cc/images/2025/04/28/0607f7a91cf309b71a20d81f2b505d85.png)
**验证sudo权限：**  
使用命令：`sudo -l -U testuser`验证testuser用户是否被赋予sudo权限，在输出命令中可以看到是否可以以sudo权限运行所有命令：(ALL : ALL) ALL。  
![6](https://s1.imagehub.cc/images/2025/04/28/70f34f3c8833f020f00d23bfa5ac87dc.png)
或者使用命令：`groups testuser`查看testuser用户的所属用户组。  
![7](https://s1.imagehub.cc/images/2025/04/28/669803369a41af48850e85d1c9039496.png)

# 删除不需要的sudo权限用户
使用命令：`sudo deluser --remove-home testuser`删除testuser用户的同时也删除testuser用户的主目录。  
![8](https://s1.imagehub.cc/images/2025/04/28/51311a013543eabacdf1db5670936e03.png)

# 设置SSH最大连接数
通过修改SSH的配置文件实现设置SSH最大连接数：`sudo vim /etc/ssh/sshd_config`。 
找到`MaxSessions`并取消注释，更改MaxSessions数值即可。  
![10](https://s1.imagehub.cc/images/2025/04/28/ac9dbe6740bc7da7c18300903bf584c8.png)
最后重启ssh服务`sudo systemctl restart sshd`。  

# 设置SSH连接超时时间
通过修改SSH的配置文件实现设置SSH连接超时时间：`sudo vim /etc/ssh/sshd_config`。  
**ClientAliveInterval：**  
SSH服务器会每隔N秒向SSH客户端发送一个空心跳包，用于检测客户端是否仍在线。  
**ClientAliveCountMax：**  
SSH服务器在连续N次未收到SSH客户端对心跳包的响应后，会主动断开SSH连接。  
**举例：**  

```txt
# SSH服务器每隔60秒向SSH客户端发送一个空心跳包；
ClientAliveInterval 60
# SSH服务器连续3次未收到SSH客户端对心跳包的响应后，会主动断开SSH连接;
ClientAliveCountMax 3

# 总超时时间为60*3=180秒=3分钟;
```

设置ClientAliveInterval字段为600，ClientAliveCountMax为0。客户端无响应即立即断开。  
![11](https://s1.imagehub.cc/images/2025/04/28/0195bcbf6e0d81a5351ea2b463c5716f.png)
最后重启ssh服务`sudo systemctl restart sshd`。  
查看SSH服务状态，确认无报错。  
![12](https://s1.imagehub.cc/images/2025/04/28/b39819f36eccf095b09336ac7194874b.png)
查看配置是否加载：`sudo sshd -T | grep -E "clientaliveinterval|clientalivecountmax"`。  
![13](https://s1.imagehub.cc/images/2025/04/28/0e3861686d1721694dfb545bf3d0ad35.png)
